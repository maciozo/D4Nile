<!DOCTYPE html>
<html>
	<head>
		<title>ITCHEN postman</title>
	</head>
	<body>
		<h1>Welcome to ITCHEN postman status</h1>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script>
		<script type="text/javascript">
			// container for current attitude from server
			let attitude = {
				roll: 0,
				pitch: 0,
				yaw: 0,
			};
			let quad;

			// handle WebScoket
			const socket = new WebSocket("ws://localhost:8080");
			socket.onopen = function (event) {
				socket.send("Hello from client");
			}
			socket.onmessage = event => {
				console.log('received:', event.data);
				attitude = JSON.parse(event.data);
			}

			// create new WebGL scene and camera
			const scene = new THREE.Scene();
			const camera = new THREE.PerspectiveCamera(75, 1.5, 0.1, 1000);

			// set canvas size and add to document
			const renderer = new THREE.WebGLRenderer();
			renderer.setSize(600, 400);
			document.body.appendChild(renderer.domElement);

			// load quad with Lambertian material asynchonously from server
			const loader = new THREE.JSONLoader();
			loader.load('dronemodel', function(geometry, materials) {
				const material = new THREE.MeshLambertMaterial({color: 0xFF00FF});
				quad = new THREE.Mesh(geometry, material);
				scene.add(quad);
			});

			// create light sources to illuminate Lambertian material
			const light1 = new THREE.PointLight(0xFFFFFF);
			light1.position.set(50, 50, 50);
			scene.add(light1);
			const light2 = new THREE.PointLight(0xFFFFFF);
			light2.position.set(-50, -50, 50);
			scene.add(light2);

			// camera distance from origin
			camera.position.z = 15;
			
			// render loop - set cube rotation from server data on each loop
			(function render() {
				requestAnimationFrame(render);
				quad.rotation.x = attitude.pitch;
				quad.rotation.y = attitude.yaw;
				quad.rotation.z = attitude.roll;
				renderer.render(scene, camera);
			})();
		</script>
	</body>
</html>