<!DOCTYPE html>
<html>
	<head>
		<title>ITCHEN postman</title>
	</head>
	<body>
		<h1>Welcome to ITCHEN postman status</h1>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/84/three.min.js"></script>
		<script type="text/javascript">
			// container for current attitude from server
			let attitude = {
				roll: 0,
				pitch: 0,
				yaw: 0,
			};

			// handle WebScoket
			const socket = new WebSocket("ws://localhost:8080");
			socket.onopen = function (event) {
				socket.send("Hello from client");
			}
			socket.onmessage = event => {
				console.log('received:', event.data);
				attitude = JSON.parse(event.data);
			}

			// create new WebGL scene and camera
			const scene = new THREE.Scene();
			const camera = new THREE.PerspectiveCamera(75, 1.5, 0.1, 1000);

			// set canvas size and add to document
			const renderer = new THREE.WebGLRenderer();
			renderer.setSize(600, 400);
			document.body.appendChild(renderer.domElement);

			// create green cube with Lambertian material
			const geometry = new THREE.BoxGeometry(1, 1, 1);
			const material = new THREE.MeshLambertMaterial({color: 0x00FF00});
			const cube = new THREE.Mesh(geometry, material);
			scene.add(cube);

			// create light source to illuminate Lambertian material
			const light = new THREE.PointLight(0xFFFFFF);
			light.position.set(50, 50, 50);
			scene.add(light);

			camera.position.z = 5;
			
			// render loop - set cube rotation from server data on each loop
			(function render() {
				requestAnimationFrame(render);
				cube.rotation.x = attitude.pitch;
				cube.rotation.y = attitude.yaw;
				cube.rotation.z = attitude.roll;
				renderer.render(scene, camera);
			})();
		</script>
	</body>
</html>